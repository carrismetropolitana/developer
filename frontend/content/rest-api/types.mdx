---
title: 2. Types
description: Common response structure and NPM package.
---

### Response Structure

All responses (should) follow the same basic structure, based on the [JSend](https://github.com/omniti-labs/jsend) specification.
This allows us to provide additional debug information for each endpoint, if needed, and standardizes the responses.
Also, in case of errors, there is a structured way of explaining what is wrong and how it might be fixed.

```json title="Success Response"
{
	status: "success",
	resource_timestamp: 1721023200,
	server_timestamp: 1721041200,
	data: [] or {} // The requested data
}
```

```json title="Error Response"
{
	status: "error",
	server_timestamp: 1721041200,
	message: "Unable to communicate with database"
}
```

### What are the timestamps for?

To answer this, it is necessary to explain a little bit about how the API works behind the scenes.
The API is composed of several modules that fetch, parse and store data from multiple sources. For example, the data source for stops and lines is the GTFS; For service alerts we use an internal database; For stores occupancy we periodicaly call a commercial service API.
If we were to perform this actions everytime someone fetched an endpoint, either it would take a long time to answer or we would flood other services with requests, bringing them down.

To overcome this scenario we decouple the _serving responses_ part from the _fetching and parsing data_ part. Data is periodicaly fetched, parsed and stored in a cache database (redis).
As such, `resource_timestamp` represents when this step occurred.

After storing it in Redis, data is served thousands of times to thousands of clients. We agressively employ several layers of cache to ensure very fast response times
and always-on service, even during outages. `server_timestamp` represents when the server first fetched the data from the database and sent it to the client, just before
it was cached by the next layers in the chain (nginx and Cloudflare).

These timestamps allows for the API consumers to understand when the response data was processed and when it entered cache.


### NPM package

We provide an NPM package to tipify all the API responses in javascript clients. We plan to expand this package with more functionality in the future. Pull Requests are welcomed!
Please find the package here: https://www.npmjs.com/package/@carrismetropolitana/api-types

